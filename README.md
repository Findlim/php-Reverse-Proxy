# php反向代理

## 基本目标

镜像站点，并输出，用于替代nginx的反向代理

## 已经实现

v1 全站的反代

v1 header跟随跳转

v1 cookies的基本适配

## 计划中
缓存的建立更新、删除

cookies和session的同步等功能的实现

ip地址的穿透

简单的字符串替换等

基于url规则的缓存方案

可视化的管理后台

### 注意
完全是基于虚拟主机的环境来实现php的反向代理，因廉价虚拟机主机的特性以及限制。

所以无法使用多线程等特性。

redis memcache等内存加速等均不在优先考虑范围之内。

因廉价虚拟主机特性是空间大而mysql数据库小，所以优先基于文件的缓存（v2）或文件性数据库（v3）。

因文件管理方式较为混乱且不利于后期维护迁移等操作，所以采用v3版开始采用sqlite数据库来管理，但sqlite库的高并发尤其是写入锁的限制，导致无法使用常规办法来处理。

所以计划 采取至少2个sqlite表（每个表独占一个库）并才用平日读取，定时写入的方式来解决高并发访问的问题。
 一个是索引表，用于管理记录索引地址状态 文件大小等。
 另外一个库记录内容： 在文件缓存数量超过指定数量的时候，触发入库操作，暂停前台访问(返回一个提示刷新的页面（如果是json返回指定的json内容）)把内容整体入库后恢复访问。
